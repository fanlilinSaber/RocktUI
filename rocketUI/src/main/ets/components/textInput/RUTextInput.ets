/**
 * Author:fanlilin
 * Date:2024/7/10
 * Descrobe:
 */

/**
 * RUTextInput æŽ§åˆ¶ä¸­å¿ƒæ‰©å±•
 */
export class RUTextInputControl extends TextInputController {

}

/**
 * è‡ªå®šä¹‰å·¦è¾¹å›¾æ ‡
 */
export interface RUTextInputleftIcon {
  iconSrc?: ResourceStr
  size?: Size
  margin?: Margin | Length | LocalizedMargin
}

/**
 * å·¦è¾¹å›¾æ ‡ç±»åž‹
 */
export enum RUTextInputLeftIconType {
  // æ— æ ·å¼
  None,
  // å·¦è¾¹å¸¦æœç´¢ðŸ”
  Search
}

@Component
export struct RUTextInput {
  // æ–‡æœ¬ï¼ˆå¿…é¡»å¤–éƒ¨åˆå§‹åŒ–æˆ–ä½¿ç”¨`$`ç»‘å®šï¼‰
  @Link text: ResourceStr
  // å ä½ç¬¦
  @Prop placeholder?: ResourceStr
  // æ–‡æœ¬å­—ä½“
  font: Font = { size: 13 }
  // æ–‡æœ¬å­—ä½“é¢œè‰²
  color: ResourceColor = $r('app.color.ru_color_FF333333')
  // å ä½ç¬¦å­—ä½“
  placeholderFont: Font = { size: 13 }
  // å ä½ç¬¦é¢œè‰²
  placeholderColor: ResourceColor = $r('app.color.ru_color_FFC0C4CC')
  // æœ€å¤§è¡Œæ•°
  maxLines?: number
  // è¾“å…¥ç±»åž‹
  type: InputType = InputType.Normal
  // å†…ç½®æ ·å¼
  style: TextInputStyle = TextInputStyle.Default
  // å·¦è¾¹å›¾æ ‡
  leftIcon?: RUTextInputleftIcon | RUTextInputLeftIconType
  // èƒŒæ™¯è‰²
  bgColor: ResourceColor = $r('app.color.ru_color_FFFFFFFF')
  // åœ†è§’
  xborderRadius: Length | BorderRadiuses | LocalizedBorderRadiuses = 5
  // é«˜åº¦
  xheight: Length = 33
  // å†…è¾¹è·æŽ§åˆ¶
  xpadding?: Padding | Length | LocalizedPadding
  // æ˜¯å¦å¸¦æ¸…é™¤æŒ‰é’®
  showClearIcon: boolean = true
  // åœ¨type = å¯†ç æ¨¡å¼ä¸‹ï¼Œæ˜¯å¦æ˜¾ç¤ºå³è¾¹çœ¼ç›ðŸ‘å›¾æ ‡
  showPasswordIcon: boolean = true
  // çœ¼ç›å›¾æ ‡è‡ªå®šä¹‰
  passwordIcon?: PasswordIcon
  // è¾“å…¥å­—ç¬¦æœ€å¤§é•¿åº¦é™åˆ¶
  maxLength?: number
  // æ’å…¥å…‰æ ‡ç¬¦é¢œè‰²
  caretColor: ResourceColor = $r('app.color.ru_main_color')
  // æ–‡æœ¬è¾“å…¥å›žè°ƒ
  onChange?: (value: string) => void
  // æŒ‰ä¸‹è¾“å…¥æ³•å›žè½¦é”®è§¦å‘è¯¥å›žè°ƒ
  onSubmit?: (enterKey: EnterKeyType, event: SubmitEvent) => void
  // æŽ§åˆ¶å™¨
  control?: RUTextInputControl

  build() {
    Row() {
      this.leftArea()

      TextInput({ text: $$this.text, placeholder: this.placeholder, controller: this.control })
        .fontSize(this.font.size)
        .fontWeight(this.font.weight)
        .fontColor(this.color)
        .placeholderColor(this.placeholderColor)
        .placeholderFont(this.placeholderFont)
        .borderRadius(0)
        .style(this.style)
        .maxLines(this.maxLines)
        .showPasswordIcon(this.showPasswordIcon)
        .passwordIcon(this.passwordIcon)
        .backgroundColor(Color.Transparent)
        .type(this.type)
        .caretColor(this.caretColor)
        .padding(0)
        .maxLength(this.maxLength)
        .layoutWeight(1)
        .onChange(this.onChange)
        .onSubmit(this.onSubmit)

      if (this.showClearIcon) {
        Image($r('app.media.ru_ic_clear'))
          .width(13).height(13).margin({ left: 10, right: 10 })
          .visibility(!!this.text ? Visibility.Visible : Visibility.None)
          .onClick(() => {
            this.text = ''
          })
      }
    }
    .height(this.xheight)
    .borderRadius(this.xborderRadius)
    .backgroundColor(this.bgColor)
    .padding(this.xpadding)
  }

  @Builder
  leftArea() {
    if (typeof this.leftIcon === 'number' && this.leftIcon === RUTextInputLeftIconType.Search) {
      Image($r('app.media.ru_ic_search'))
        .width(15).height(15).margin({ left: 10, right: 10 })
    } else if (typeof this.leftIcon === 'object') {
      Image(this.leftIcon.iconSrc)
        .size(this.leftIcon.size ?? { width: 15, height: 15})
        .margin(this.leftIcon.margin ?? { left: 10, right: 10 })
    }
  }
}